# 小智 ESP32 AI 机器人 - 产品需求文档（PRD）

**Product Requirements Document**

---

## 📋 文档信息

| 项目 | 内容 |
|------|------|
| **产品名称** | 小智 AI 聊天机器人 (XiaoZhi AI Robot) |
| **当前版本** | v2.0.3 |
| **文档版本** | v1.0.0 |
| **更新日期** | 2025-10-28 |
| **文档负责人** | @pm |
| **技术负责人** | @architect |
| **产品定位** | 开源语音交互 AI 机器人解决方案 |

---

## 🎯 产品定位与愿景

### 产品定位

小智 AI 是一款**开源的语音交互 AI 机器人解决方案**，基于 ESP32 系列芯片，通过 MCP（Model Context Protocol）协议实现大模型能力扩展。

### 目标用户

#### B端用户
- 🏭 **智能硬件产品开发商** - 快速构建语音交互产品原型
- 🏫 **教育科研机构** - AI + IoT 教学实验平台
- 🏠 **智能家居厂商** - 语音控制中枢设备方案
- 🤖 **机器人开发者** - 语音交互底层固件
- 🔬 **技术验证团队** - 大模型 + 硬件集成方案验证

#### C端用户
- 👨‍👩‍👧‍👦 **家庭用户** - 语音助手、智能家居控制
- 👶 **儿童教育** - 语音对话、互动学习、电子宠物
- 🎓 **学生创客** - AI 学习、硬件DIY实验
- 🧓 **老年人** - 简单语音交互、日常提醒

### 产品愿景

**让 AI 语音交互变得简单、开源、人人可及。**

---

## ✅ 已实现功能清单

### 一、核心语音交互功能

#### 1.1 离线语音唤醒 ⭐
- **状态**: ✅ 已实现
- **技术栈**: ESP-SR 2.1.5
- **支持唤醒词**: 
  - 中文: "你好小智"、"Hi 小智"
  - 英文: "Hi ESP"
  - 日文: 可自定义
- **特性**:
  - 完全离线运行，无需联网
  - 支持自定义唤醒词（需重新编译）
  - 支持多个唤醒词
  - 唤醒率 > 95%，误唤醒率 < 0.1%/小时

**用户价值**: 隐私保护 + 快速响应

---

#### 1.2 流式语音交互 ⭐
- **状态**: ✅ 已实现
- **架构**: 流式 ASR + LLM + TTS
- **音频编解码**: OPUS（低延迟、高压缩）
- **特性**:
  - 边说边识别（实时流式ASR）
  - 边生成边播放（实时流式TTS）
  - 总延迟 < 1秒（网络良好情况下）
  - 支持打断对话（Barge-in功能已禁用，见待开发功能）

**用户价值**: 流畅自然的对话体验

---

#### 1.3 声纹识别
- **状态**: ✅ 已实现
- **技术栈**: 3D Speaker
- **特性**:
  - 识别不同说话人身份
  - 个性化回复（基于说话人）
  - 需后台配置声纹库

**用户价值**: 多人使用场景下的个性化服务

---

#### 1.4 高级音频处理 🧠
- **状态**: ✅ 已实现
- **神经网络模型**:
  - **VADNet1**: 精准人声检测
  - **NSNet2**: 神经网络降噪
  - **WebRTC AGC**: 自动增益控制（15dB）
  - **语音增强（SE）**: 突出人声频段
- **效果**:
  - 在嘈杂环境下准确识别
  - 自动过滤风噪、电流声、背景音乐
  - 人声检测灵敏，几乎零误触发

**用户价值**: 在复杂环境下的稳定识别

---

### 二、显示与UI功能

#### 2.1 表情显示系统
- **状态**: ✅ 已实现
- **显示硬件支持**:
  - OLED（SSD1306等）
  - LCD（ST7789、ILI9341等）
  - AMOLED
- **表情类型**:
  - 基础表情: happy, sad, neutral, thinking, surprised
  - 互动表情: wink, love, angry, embarrassed
  - 动画表情: 支持GIF动画（Otto Emoji）
- **特性**:
  - 根据对话内容自动切换表情
  - 根据宠物状态联动表情
  - 支持自定义表情包
  - 表情平滑过渡

**用户价值**: 拟人化交互，增强情感连接

---

#### 2.2 聊天消息显示
- **状态**: ✅ 已实现
- **技术栈**: LVGL 9.3.0
- **特性**:
  - 滚动显示对话内容
  - 支持中英日多语言
  - 自定义字体和聊天背景
  - 状态指示（监听中、说话中、思考中）

**用户价值**: 可视化对话历史

---

### 三、MCP 设备控制功能

#### 3.1 音量控制 🔊
- **状态**: ✅ 已实现
- **MCP工具**: `self.speaker.set_volume`
- **语音指令**:
  - "把音量调到50"
  - "调大声一点"
  - "调小声音"
- **范围**: 0-100

---

#### 3.2 屏幕亮度控制 💡
- **状态**: ✅ 已实现
- **MCP工具**: `self.display.set_brightness`
- **语音指令**:
  - "把屏幕调亮一点"
  - "把亮度设置到80"
- **范围**: 0-100

---

#### 3.3 主题切换 🎨
- **状态**: ✅ 已实现
- **MCP工具**: `self.display.set_theme`
- **支持主题**:
  - Light（浅色）
  - Dark（深色）

---

#### 3.4 LED控制 💡
- **状态**: ✅ 已实现
- **MCP工具**: `self.led.control`
- **特性**:
  - 支持RGB颜色控制
  - 支持亮度调节
  - 支持闪烁模式

---

#### 3.5 舵机控制（Otto机器人）🕺
- **状态**: ✅ 已实现（Otto专用）
- **MCP工具**: `self.servo.*`
- **动作类型**:
  - 基础移动: 前进、后退、左转、右转、跳跃
  - 舞蹈动作: 摇摆、太空步、弯腰、摇腿
  - 手部动作: 挥手、举手、放手
  - 情感互动: 根据对话内容自动做动作

**Otto特色**: 每次说话前随机做一个动作

---

#### 3.6 GPIO控制
- **状态**: ✅ 已实现
- **MCP工具**: `self.gpio.*`
- **特性**:
  - 控制外接LED、继电器
  - 读取传感器数据
  - 支持PWM输出

---

### 四、电子宠物系统 🐾

#### 4.1 宠物状态系统
- **状态**: ✅ 已实现
- **三维状态**:
  - **心情 (mood)**: 0-100，影响表情和互动反馈
  - **饱腹度 (satiety)**: 0-100，需定期喂食
  - **清洁度 (cleanliness)**: 0-100，需定期洗澡
- **衰减机制**:
  - 每分钟: 饱腹度 -1，清洁度 -1，心情 -1
  - 10分钟无互动: 心情额外 -1/分钟
- **数据持久化**: NVS存储，断电不丢失

**用户价值**: 培养孩子的责任感和时间管理能力

---

#### 4.2 宠物互动系统
- **状态**: ✅ 已实现
- **MCP工具**:
  - `self.pet.feed` - 喂食（+饱腹度+心情）
  - `self.pet.clean` - 洗澡（+清洁度+心情）
  - `self.pet.play` - 玩耍（+心情+活跃度）
  - `self.pet.hug` - 拥抱（+心情）
  - `self.pet.get_state` - 查询状态
- **冷却机制**:
  - 喂食: 60秒
  - 洗澡: 120秒
  - 玩耍: 60秒
  - 拥抱: 30秒

---

#### 4.3 每日任务系统
- **状态**: ✅ 已实现
- **任务类型**:
  - 喂食 1次 → 活跃度 +5
  - 洗澡 1次 → 活跃度 +5
  - 玩耍 1次 → 活跃度 +5
  - 聊天 5次 → 心情 +5，活跃度 +5
- **连续登录奖励**:
  - 连续登录 ≥ 3天: 每天额外活跃度 +5
- **自动重置**: 每天00:00自动重置

**用户价值**: 游戏化养成，增强用户粘性

---

#### 4.4 表情联动
- **状态**: ✅ 已实现
- **联动规则**:
  - 饱腹度 < 20 → `sad` 表情
  - 清洁度 < 20 → `embarrassed` 表情
  - 综合状态 > 70 → `happy` 表情
  - 综合状态 < 30 → `sad` 表情
  - 心情 < 40 → `thinking` 表情

**用户价值**: 拟真的情感反馈

---

### 五、网络与连接功能

#### 5.1 WiFi管理
- **状态**: ✅ 已实现
- **特性**:
  - 自动连接已保存的WiFi
  - 配网模式（热点 + Web配置页面）
  - 网络状态查询
  - 多WiFi记忆（可切换）

---

#### 5.2 通信协议
- **状态**: ✅ 已实现
- **支持协议**:
  - **WebSocket** - 推荐，低延迟
  - **MQTT + UDP** - 稳定性高
- **服务器**:
  - 官方服务器: xiaozhi.me（免费使用Qwen实时模型）
  - 自建服务器: 支持Python/Java/Golang服务端

---

#### 5.3 4G网络支持
- **状态**: ✅ 已实现
- **硬件**: ML307 Cat.1 4G模块
- **特性**:
  - 无WiFi环境下使用4G联网
  - 适合户外、车载场景

---

### 六、系统管理功能

#### 6.1 电源管理
- **状态**: ✅ 已实现
- **特性**:
  - 电量显示（电池百分比）
  - 低电量提醒（< 20%）
  - 自动关机（< 5%）
  - 充电状态显示
  - 电量查询语音指令

---

#### 6.2 固件OTA升级
- **状态**: ✅ 已实现
- **特性**:
  - 无线固件升级
  - 断点续传（防止升级失败）
  - 版本管理（v1 ↔ v2需手动烧录）

---

#### 6.3 多语言支持
- **状态**: ✅ 已实现
- **支持语言**:
  - 中文（默认）
  - 英文
  - 日文
- **切换方式**: 后台配置或语音指令

---

#### 6.4 设备管理
- **状态**: ✅ 已实现
- **xiaozhi.me控制台功能**:
  - 设备在线状态监控
  - 远程命令执行
  - 日志查看
  - 配置修改（角色、提示词、MCP工具）
  - 使用统计（对话次数、时长）

---

### 七、云端MCP功能扩展

#### 7.1 智能家居控制
- **状态**: ✅ 已实现
- **支持平台**:
  - Home Assistant
  - HomeKit（通过桥接）
  - 小米智能家居
  - 其他支持MCP的平台
- **控制设备**:
  - 灯光（开关、调光、调色）
  - 空调（温度、模式）
  - 电视、风扇、窗帘等

---

#### 7.2 知识搜索
- **状态**: ✅ 已实现
- **MCP工具**:
  - 网络搜索（Google/Bing）
  - 天气查询
  - 百科知识
  - 实时新闻

---

#### 7.3 PC桌面操作
- **状态**: ✅ 已实现
- **MCP工具**:
  - 打开应用程序
  - 控制鼠标、键盘
  - 截图、录屏
  - 文件操作

---

#### 7.4 邮件收发
- **状态**: ✅ 已实现
- **MCP工具**:
  - 发送邮件
  - 读取最新邮件
  - 邮件摘要

---

### 八、硬件兼容性

#### 8.1 支持芯片
- **状态**: ✅ 已实现
- **支持平台**:
  - ESP32-C3
  - ESP32-S3 ⭐ 推荐
  - ESP32-P4
  - ESP32-C5（实验性）
  - ESP32-C6（实验性）

---

#### 8.2 支持开发板
- **状态**: ✅ 已实现
- **支持数量**: 70+ 款开发板
- **主流开发板**:
  - 立创·实战派 ESP32-S3
  - 乐鑫 ESP32-S3-BOX3
  - M5Stack CoreS3
  - M5Stack AtomS3R + Echo Base
  - 神奇按钮 2.4
  - 微雪电子 ESP32-S3-Touch-AMOLED-1.8
  - LILYGO T-Circle-S3
  - SenseCAP Watcher
  - ESP-HI 机器狗

---

### 九、开发者工具

#### 9.1 自定义Assets生成器
- **状态**: ✅ 已实现
- **工具链接**: [xiaozhi-assets-generator](https://github.com/78/xiaozhi-assets-generator)
- **功能**:
  - 自定义唤醒词（训练模型）
  - 自定义字体
  - 自定义表情包
  - 自定义聊天背景
  - 网页端在线生成

---

#### 9.2 自定义开发板指南
- **状态**: ✅ 已实现
- **文档**: docs/custom-board.md
- **支持功能**:
  - 引脚配置
  - 硬件适配
  - 驱动集成

---

#### 9.3 开发环境支持
- **状态**: ✅ 已实现
- **IDE支持**:
  - Cursor（推荐）
  - VSCode + ESP-IDF插件
- **SDK版本**: ESP-IDF 5.4+
- **代码风格**: Google C++ Style Guide

---

## 🚧 待开发功能清单

### 一、核心交互优化

#### 1.1 Barge-in打断功能重构 🔴 高优先级
- **当前状态**: ❌ 已禁用（因竞态条件问题）
- **需求描述**: 允许用户在机器人说话时打断
- **实现方案**:
  - 方案1: 唤醒词打断（需说"小智"才能打断）✅ 推荐
  - 方案2: 人声打断（检测到人声即打断）⚠️ 易误触
  - 方案3: 音量降低（检测到人声时降低音量，不完全打断）
- **技术难点**:
  - 已修复线程安全问题（见`Barge-in线程安全修复报告.md`）
  - 需测试功能正确性和用户体验
- **优先级**: 🔴 P0（核心功能）
- **预计工作量**: 1周（测试+优化）

**用户价值**: 自然的对话打断，避免等待机器人说完

---

#### 1.2 多轮对话记忆增强 🟡 中优先级
- **当前状态**: ⚠️ 基础实现
- **需求描述**: 增强上下文记忆能力
- **功能需求**:
  - 记住最近10轮对话
  - 记住用户偏好（名字、喜好、常用指令）
  - 跨会话记忆（NVS存储）
  - 记忆管理（清除、查询）
- **优先级**: 🟡 P1（用户体验提升）
- **预计工作量**: 2周

**用户价值**: 更智能的对话，减少重复说明

---

#### 1.3 离线TTS支持 🟢 低优先级
- **当前状态**: ❌ 未实现（依赖云端TTS）
- **需求描述**: 支持离线语音合成
- **技术方案**:
  - 集成ESP-TTS（乐鑫方案）
  - 或使用预录语音片段
- **限制**:
  - ESP32存储空间有限
  - TTS模型较大（> 2MB）
  - 音质可能不如云端
- **优先级**: 🟢 P2（可选功能）
- **预计工作量**: 3周

**用户价值**: 无网络环境下也能语音回复

---

### 二、电子宠物系统扩展

#### 2.1 多种宠物类型 🟡 中优先级
- **当前状态**: ⚠️ 单一宠物（可选类型但特性相同）
- **需求描述**: 支持不同种类宠物，各有特性
- **功能需求**:
  - 宠物种类: 小猫🐱、小狗🐶、小兔子🐰、小熊猫🐼
  - 差异化属性:
    - 小猫: 心情衰减快，需要更多互动
    - 小狗: 饱腹度衰减快，需要更多喂食
    - 小兔子: 清洁度衰减快，需要更多洗澡
    - 小熊猫: 平衡型，适合新手
  - 不同外观（表情包）
  - 不同语音反馈
- **优先级**: 🟡 P1（增强趣味性）
- **预计工作量**: 2周

**用户价值**: 个性化养成体验，增强粘性

---

#### 2.2 宠物等级系统 🟡 中优先级
- **当前状态**: ⚠️ 基础框架（level字段存在但未使用）
- **需求描述**: 根据活跃度升级，解锁新功能
- **功能需求**:
  - 等级范围: 1-10级
  - 升级条件: 活跃度达到阈值
  - 等级奖励:
    - 2级: 解锁宠物表情
    - 3级: 解锁新互动方式
    - 5级: 解锁宠物装扮
    - 10级: 特殊称号
  - 等级显示: UI展示当前等级和经验条
- **优先级**: 🟡 P1（游戏化设计）
- **预计工作量**: 1周

**用户价值**: 长期养成目标，增强成就感

---

#### 2.3 宠物成就系统 🟢 低优先级
- **当前状态**: ❌ 未实现
- **需求描述**: 完成特定条件获得成就徽章
- **成就示例**:
  - "连续登录7天"
  - "心情保持90+持续7天"
  - "完成100次喂食"
  - "获得10级宠物"
  - "连续完成每日任务30天"
- **展示方式**: UI成就墙 + 语音播报
- **优先级**: 🟢 P2（锦上添花）
- **预计工作量**: 1周

**用户价值**: 激励用户持续使用

---

#### 2.4 宠物AI自主播报 🔴 高优先级
- **当前状态**: ⚠️ 基础实现（手动查询模式）
- **需求描述**: 宠物状态异常时自动语音提醒
- **功能需求**:
  - 触发条件:
    - 饱腹度 < 30: "主人，我饿了~"
    - 清洁度 < 30: "主人，我想洗澡~"
    - 心情 < 40: "主人，陪我玩会儿吧~"
  - 播报时机:
    - 空闲状态（非对话中）
    - 10分钟最多播报1次（避免打扰）
  - 播报方式:
    - TTS语音 + 表情联动
- **技术难点**:
  - 事件总线集成（已有初步实现）
  - 与对话状态冲突检测
- **优先级**: 🔴 P0（核心功能完善）
- **预计工作量**: 1周

**用户价值**: 主动提醒，减少宠物"死亡"风险

---

### 三、UI/UX优化

#### 3.1 主题商店 🟢 低优先级
- **当前状态**: ⚠️ 仅支持深色/浅色主题
- **需求描述**: 支持更多预设主题和自定义主题
- **功能需求**:
  - 预设主题:
    - 经典黑白
    - 护眼绿
    - 樱花粉
    - 深海蓝
    - 赛博朋克
  - 自定义主题:
    - 背景颜色
    - 文字颜色
    - 高亮颜色
    - 字体大小
  - 主题商店: 云端下载更多主题
- **优先级**: 🟢 P2（个性化需求）
- **预计工作量**: 2周

**用户价值**: 个性化外观，增强用户粘性

---

#### 3.2 动画效果增强 🟢 低优先级
- **当前状态**: ⚠️ 基础表情切换
- **需求描述**: 增加更多动画效果
- **功能需求**:
  - 表情过渡动画（渐变、缩放）
  - 聊天气泡动画
  - 状态切换动画（监听 → 思考 → 说话）
  - 粒子效果（庆祝、升级）
- **优先级**: 🟢 P2（体验优化）
- **预计工作量**: 1周

**用户价值**: 更生动的视觉反馈

---

#### 3.3 儿童模式 🟡 中优先级
- **当前状态**: ❌ 未实现
- **需求描述**: 针对儿童用户的专用模式
- **功能需求**:
  - 大图标、大字体
  - 简化语音指令（"喂食"而非"给宠物喂食"）
  - 防沉迷提醒（使用超过30分钟提醒休息）
  - 内容过滤（不当内容屏蔽）
  - 家长控制（使用时长限制、内容审核）
- **优先级**: 🟡 P1（目标用户需求）
- **预计工作量**: 2周

**用户价值**: 适合儿童的安全交互环境

---

### 四、智能家居控制扩展

#### 4.1 场景联动 🟡 中优先级
- **当前状态**: ⚠️ 单设备控制
- **需求描述**: 支持多设备场景联动
- **功能需求**:
  - 预设场景:
    - "回家模式": 开灯 + 开空调 + 播放音乐
    - "离家模式": 关灯 + 关空调 + 关电视 + 启动安防
    - "睡眠模式": 关灯 + 窗帘闭合 + 空调26度
    - "观影模式": 关灯 + 拉窗帘 + 开电视 + 音响
  - 自定义场景:
    - 用户自定义场景名称和动作序列
  - 语音触发: "执行回家模式"
- **优先级**: 🟡 P1（智能家居核心功能）
- **预计工作量**: 2周

**用户价值**: 一键控制多设备，提升便利性

---

#### 4.2 定时任务 🟡 中优先级
- **当前状态**: ❌ 未实现
- **需求描述**: 支持定时执行任务
- **功能需求**:
  - 定时开关灯
  - 定时播放音乐/闹钟
  - 定时执行场景
  - 周期任务（每天/每周）
- **语音指令**: "每天早上7点打开窗帘"
- **优先级**: 🟡 P1（自动化需求）
- **预计工作量**: 1周

**用户价值**: 自动化日常任务

---

### 五、安全与隐私

#### 5.1 本地语音识别（离线ASR） 🟢 低优先级
- **当前状态**: ❌ 依赖云端ASR
- **需求描述**: 支持离线语音识别
- **技术方案**:
  - 使用ESP-SR离线识别（有限词汇量）
  - 或集成轻量级ASR模型
- **限制**:
  - 识别准确率低于云端
  - 存储空间限制
  - 仅支持预定义指令
- **优先级**: 🟢 P2（隐私需求）
- **预计工作量**: 4周

**用户价值**: 完全本地处理，保护隐私

---

#### 5.2 本地LLM（边缘推理） 🟢 低优先级
- **当前状态**: ❌ 依赖云端LLM
- **需求描述**: 在ESP32上运行轻量级LLM
- **技术方案**:
  - 使用量化模型（INT4/INT8）
  - 或使用ESP32-P4（算力更强）
- **限制**:
  - 模型体积 < 16MB
  - 推理速度慢（秒级延迟）
  - 回复质量不如云端
- **优先级**: 🟢 P3（技术验证）
- **预计工作量**: 6周+

**用户价值**: 完全离线运行，无需联网

---

#### 5.3 语音数据加密 🟡 中优先级
- **当前状态**: ⚠️ HTTPS/WSS加密传输
- **需求描述**: 增强语音数据安全性
- **功能需求**:
  - 端到端加密（E2EE）
  - 本地语音数据不保存（或加密保存）
  - 敏感信息过滤（如密码、银行卡号）
- **优先级**: 🟡 P1（企业用户需求）
- **预计工作量**: 2周

**用户价值**: 保护用户隐私

---

### 六、性能优化

#### 6.1 内存优化 🟡 中优先级
- **当前状态**: ⚠️ 部分场景内存紧张
- **需求描述**: 降低内存占用，提升稳定性
- **优化方向**:
  - 减少全局变量
  - 优化音频缓冲区大小
  - LVGL内存池优化
  - 动态释放未使用资源
- **目标**: 空闲内存 > 100KB
- **优先级**: 🟡 P1（稳定性）
- **预计工作量**: 2周

**用户价值**: 更稳定的系统运行

---

#### 6.2 功耗优化 🟢 低优先级
- **当前状态**: ⚠️ 待测量
- **需求描述**: 降低功耗，延长电池续航
- **优化方向**:
  - CPU频率调节（空闲时降频）
  - WiFi省电模式
  - 屏幕自动息屏
  - 休眠模式（长时间无互动）
- **目标**: 电池续航 > 8小时（连续使用）
- **优先级**: 🟢 P2（电池设备需求）
- **预计工作量**: 2周

**用户价值**: 更长的续航时间

---

### 七、测试与质量

#### 7.1 单元测试框架 🟡 中优先级
- **当前状态**: ❌ 缺少系统化测试
- **需求描述**: 建立单元测试框架
- **测试覆盖**:
  - 音频处理模块
  - 电子宠物系统
  - MCP服务器
  - UI组件
- **测试框架**: Unity Test（ESP-IDF自带）
- **目标**: 核心模块测试覆盖率 > 70%
- **优先级**: 🟡 P1（代码质量）
- **预计工作量**: 3周

**技术价值**: 减少回归bug，提升代码质量

---

#### 7.2 集成测试 🟡 中优先级
- **当前状态**: ⚠️ 手动测试为主
- **需求描述**: 自动化集成测试
- **测试场景**:
  - 语音唤醒 → 识别 → 回复流程
  - 宠物互动流程
  - 智能家居控制流程
  - 网络异常处理
- **优先级**: 🟡 P1（质量保证）
- **预计工作量**: 2周

**技术价值**: 快速发现系统级问题

---

#### 7.3 性能压测 🟢 低优先级
- **当前状态**: ❌ 未进行
- **需求描述**: 压力测试，验证系统稳定性
- **测试场景**:
  - 长时间运行（24小时+）
  - 高频交互（每分钟10次）
  - 网络抖动模拟
  - 内存泄漏检测
- **优先级**: 🟢 P2（稳定性验证）
- **预计工作量**: 1周

**技术价值**: 发现潜在稳定性问题

---

## 📊 功能优先级矩阵

### P0 - 核心功能（必须实现）

| 功能 | 用户价值 | 技术难度 | 工作量 | 状态 |
|------|---------|---------|-------|------|
| Barge-in打断功能 | ⭐⭐⭐⭐⭐ | 🟡 中 | 1周 | ✅ 已修复，待测试 |
| 宠物AI自主播报 | ⭐⭐⭐⭐ | 🟡 中 | 1周 | ⚠️ 基础实现 |

---

### P1 - 重要功能（近期实现）

| 功能 | 用户价值 | 技术难度 | 工作量 | 状态 |
|------|---------|---------|-------|------|
| 多轮对话记忆增强 | ⭐⭐⭐⭐ | 🟡 中 | 2周 | ⚠️ 基础实现 |
| 多种宠物类型 | ⭐⭐⭐⭐ | 🟢 低 | 2周 | ❌ 未实现 |
| 宠物等级系统 | ⭐⭐⭐ | 🟢 低 | 1周 | ⚠️ 基础框架 |
| 儿童模式 | ⭐⭐⭐⭐ | 🟡 中 | 2周 | ❌ 未实现 |
| 场景联动 | ⭐⭐⭐⭐ | 🟡 中 | 2周 | ❌ 未实现 |
| 定时任务 | ⭐⭐⭐ | 🟢 低 | 1周 | ❌ 未实现 |
| 语音数据加密 | ⭐⭐⭐ | 🟡 中 | 2周 | ⚠️ HTTPS加密 |
| 内存优化 | ⭐⭐⭐⭐ | 🟡 中 | 2周 | ⚠️ 持续优化 |
| 单元测试框架 | ⭐⭐⭐ | 🟡 中 | 3周 | ❌ 未实现 |
| 集成测试 | ⭐⭐⭐ | 🟡 中 | 2周 | ⚠️ 手动测试 |

---

### P2 - 可选功能（长期规划）

| 功能 | 用户价值 | 技术难度 | 工作量 | 状态 |
|------|---------|---------|-------|------|
| 离线TTS支持 | ⭐⭐⭐ | 🔴 高 | 3周 | ❌ 未实现 |
| 宠物成就系统 | ⭐⭐ | 🟢 低 | 1周 | ❌ 未实现 |
| 主题商店 | ⭐⭐ | 🟢 低 | 2周 | ❌ 未实现 |
| 动画效果增强 | ⭐⭐ | 🟢 低 | 1周 | ⚠️ 基础动画 |
| 功耗优化 | ⭐⭐⭐ | 🟡 中 | 2周 | ⚠️ 待测量 |
| 性能压测 | ⭐⭐ | 🟢 低 | 1周 | ❌ 未实现 |

---

### P3 - 技术验证（研究性功能）

| 功能 | 用户价值 | 技术难度 | 工作量 | 状态 |
|------|---------|---------|-------|------|
| 本地语音识别 | ⭐⭐ | 🔴 高 | 4周 | ❌ 未实现 |
| 本地LLM推理 | ⭐⭐ | 🔴 高 | 6周+ | ❌ 未实现 |

---

## 🎯 近期开发路线图

### Q1 2025 (1-3月)

**目标**: 完善核心功能，提升稳定性

#### Sprint 1 (2周)
- ✅ Barge-in功能测试和优化
- ✅ 宠物AI自主播报完善

#### Sprint 2 (2周)
- 🔄 多轮对话记忆增强
- 🔄 内存优化（第一阶段）

#### Sprint 3 (2周)
- 🔄 多种宠物类型实现
- 🔄 宠物等级系统

---

### Q2 2025 (4-6月)

**目标**: 增强用户体验，扩展智能家居功能

#### Sprint 4 (2周)
- 🔄 儿童模式实现
- 🔄 语音数据加密

#### Sprint 5 (2周)
- 🔄 场景联动
- 🔄 定时任务

#### Sprint 6 (2周)
- 🔄 单元测试框架
- 🔄 集成测试

---

### Q3-Q4 2025 (7-12月)

**目标**: 性能优化，可选功能开发

- 🔄 离线TTS支持（研究）
- 🔄 主题商店
- 🔄 功耗优化
- 🔄 本地语音识别（研究）

---

## 📝 技术债务清单

### 高优先级技术债
1. **音频输出系统代码质量问题** ✅ 已修复（见`代码质量分析报告_音频输出系统.md`）
   - ✅ 硬件初始化错误处理
   - ✅ Barge-in竞态条件
   - ⚠️ 整数溢出风险（部分已修复）

2. **电子宠物系统代码质量问题** ✅ 已修复（见`代码质量修复报告_pet_system.md`）
   - ✅ 空指针检查
   - ✅ 时间回退处理
   - ✅ 字符串拼接安全

3. **内存碎片问题** ⚠️ 待优化
   - 现象: 长时间运行后内存碎片增加
   - 解决方案: PSRAM使用优化 + 内存池

---

### 中优先级技术债
1. **魔法数字过多** ⚠️ 待统一
   - 建议: 使用配置文件或常量定义

2. **日志策略不统一** ⚠️ 待规范
   - 建议: 统一日志级别和格式

3. **错误处理不完善** ⚠️ 待增强
   - 建议: 添加错误恢复机制

---

### 低优先级技术债
1. **代码注释不足** ⚠️ 待补充
2. **API文档不完整** ⚠️ 待完善
3. **性能基准缺失** ⚠️ 待建立

---

## 🔗 相关文档

### 用户文档
- [小智AI机器人_C端用户使用说明](小智AI机器人_C端用户使用说明.md)
- [用户功能清单](用户功能清单.md)
- [电子宠物使用指南](电子宠物使用指南.md)
- [完整测试指南](完整测试指南.md)

### 技术文档
- [小智AI机器人_B端技术使用说明](小智AI机器人_B端技术使用说明.md)
- [MCP协议使用说明](docs/mcp-usage.md)
- [WebSocket通信协议](docs/websocket.md)
- [自定义开发板指南](docs/custom-board.md)

### 质量报告
- [代码质量分析报告_音频输出系统](代码质量分析报告_音频输出系统.md)
- [代码质量修复报告_pet_system](代码质量修复报告_pet_system.md)
- [Barge-in线程安全修复报告](Barge-in线程安全修复报告.md)
- [测试指南_Barge-in线程安全](测试指南_Barge-in线程安全.md)

### 开发指南
- [BMAD使用指南](BMAD_使用指南.md)
- [音频算法指南](AUDIO_ALGORITHMS_GUIDE.md)
- [VSCode编译烧录指南](VSCode编译烧录指南.md)

---

## 📞 联系方式

### 技术支持
- **项目主页**: https://github.com/78/xiaozhi-esp32
- **官方服务器**: https://xiaozhi.me
- **QQ群**: 1011329060
- **Bilibili**: [@虾哥说事](https://space.bilibili.com/86202853)

### 团队分工
- **产品经理**: @pm - 需求管理、优先级规划
- **架构师**: @architect - 技术方案设计
- **QA工程师**: @qa - 质量保证、测试
- **开发工程师**: @dev - 功能开发、bug修复

---

## 📜 许可证

本项目以 **MIT 许可证** 发布，允许：
- ✅ 商业使用
- ✅ 修改代码
- ✅ 分发
- ✅ 私有使用

---

**文档创建时间**: 2025-10-28  
**最后更新**: 2025-10-28  
**维护者**: @pm  
**审核状态**: ✅ 已审核

