# ğŸ§  å°æ™ºå…¨ç³»ç»Ÿè‡ªé€‚åº”å‡çº§æ–¹æ¡ˆ

## ğŸ“‹ å‡çº§ç›®æ ‡

**è®©å°æ™ºä»"æ™ºèƒ½åŠ©æ‰‹"å‡çº§ä¸º"ä¼šå­¦ä¹ çš„é™ªä¼´æœºå™¨äºº"**

### å½“å‰çŠ¶æ€
- âœ… æœ‰å­¦ä¹ æ¡†æ¶ï¼ˆUser Profile + Decision Engine + Event Busï¼‰
- âœ… æ•°æ®åœ¨æ”¶é›†ï¼ˆäº’åŠ¨æ¬¡æ•°ã€æ—¶é•¿ã€è¯é¢˜ã€æ—¶æ®µï¼‰
- âŒ **å­¦ä¹ æ•°æ®æœªè¢«å……åˆ†åˆ©ç”¨**
- âŒ **è¡Œä¸ºä»ç„¶æ˜¯é™æ€çš„**

### å‡çº§å
- âœ… æ‰€æœ‰æ¨¡å—éƒ½èƒ½å­¦ä¹ ç”¨æˆ·ä¹ æƒ¯
- âœ… è¡Œä¸ºéšæ—¶é—´ä¸ªæ€§åŒ–è°ƒæ•´
- âœ… æ¦‚ç‡æ€§ã€æƒ…å¢ƒæ„ŸçŸ¥çš„ååº”
- âœ… é•¿æœŸé™ªä¼´æ„Ÿ

---

## ğŸ¯ å‡çº§èŒƒå›´ï¼ˆ8 å¤§æ¨¡å—ï¼‰

### 1. ğŸ¾ å® ç‰©ç³»ç»Ÿï¼ˆPet Systemï¼‰

**å½“å‰é—®é¢˜**ï¼š
- å›ºå®šè¡°å‡é€Ÿç‡
- å›ºå®šè­¦å‘Šé˜ˆå€¼
- æ‰€æœ‰ç”¨æˆ·ä½“éªŒä¸€æ ·

**å‡çº§å†…å®¹**ï¼š
- [P0] è‡ªé€‚åº”è¡°å‡é€Ÿç‡ï¼ˆåŸºäºäº’åŠ¨é¢‘ç‡ï¼‰
- [P1] æ¦‚ç‡æ€§ååº”ï¼ˆä¸åŒå¿ƒæƒ…ä¸åŒè¯è¯­ï¼‰
- [P1] æ—¶æ®µæ„ŸçŸ¥ï¼ˆå¤œé—´/å·¥ä½œæ—¶å‡å°‘æ‰“æ‰°ï¼‰
- [P2] æƒ…ç»ªç´¯ç§¯ç³»ç»Ÿï¼ˆé•¿æœŸä¸äº’åŠ¨ä¼š"æƒ³å¿µ"ï¼‰

---

### 2. ğŸ­ è¡¨æƒ…ç³»ç»Ÿï¼ˆDisplay/Emotionï¼‰

**å½“å‰é—®é¢˜**ï¼š
- è¡¨æƒ…åˆ‡æ¢å›ºå®š
- ä¸è€ƒè™‘ç”¨æˆ·åé¦ˆ

**å‡çº§å†…å®¹**ï¼š
- [P0] è¡¨æƒ…æ´»è·ƒåº¦è‡ªé€‚åº”ï¼ˆæ ¹æ®ç”¨æˆ·åé¦ˆï¼‰
- [P1] è¡¨æƒ…éšæ—¶æ®µå˜åŒ–ï¼ˆæ—©æ™¨ç²¾ç¥ï¼Œæ™šä¸Šæ¸©æŸ”ï¼‰
- [P2] è¡¨æƒ…è®°å¿†ï¼ˆè®°ä½ç”¨æˆ·å–œæ¬¢çš„è¡¨æƒ…ï¼‰

---

### 3. ğŸ’¬ å¯¹è¯ç³»ç»Ÿï¼ˆApplication/Protocolï¼‰

**å½“å‰é—®é¢˜**ï¼š
- AI å›å¤ä¸è€ƒè™‘å†å²
- ä¸è®°ä½ç”¨æˆ·åå¥½

**å‡çº§å†…å®¹**ï¼š
- [P0] è¯é¢˜æ¨èï¼ˆåŸºäºå†å²åå¥½ï¼‰
- [P1] ä¸»åŠ¨é—®å€™ï¼ˆæ ¹æ®æ´»è·ƒæ—¶æ®µï¼‰
- [P2] ä¸ªæ€§åŒ–å›å¤é£æ ¼ï¼ˆå­¦ä¹ ç”¨æˆ·å–œå¥½ï¼‰

---

### 4. â° æé†’ç³»ç»Ÿï¼ˆReminder/Alertï¼‰

**å½“å‰é—®é¢˜**ï¼š
- æé†’é—´éš”å›ºå®š
- ä¸è€ƒè™‘ç”¨æˆ·ä¹ æƒ¯

**å‡çº§å†…å®¹**ï¼š
- [P0] è‡ªé€‚åº”æé†’é—´éš”
- [P1] æ™ºèƒ½å…æ‰“æ‰°ï¼ˆå·¥ä½œæ—¶/ç¡çœ æ—¶ï¼‰
- [P2] é¢„æµ‹æ€§æé†’ï¼ˆå­¦ä¹ ç”¨æˆ·æ—¥ç¨‹ï¼‰

---

### 5. ğŸ”Š éŸ³é¢‘ç³»ç»Ÿï¼ˆAudio Serviceï¼‰

**å½“å‰é—®é¢˜**ï¼š
- éŸ³é‡å›ºå®šæˆ–æ‰‹åŠ¨è°ƒèŠ‚
- å”¤é†’çµæ•åº¦å›ºå®š

**å‡çº§å†…å®¹**ï¼š
- [P1] è‡ªé€‚åº”éŸ³é‡ï¼ˆæ ¹æ®æ—¶æ®µå’Œç¯å¢ƒï¼‰
- [P2] å”¤é†’çµæ•åº¦è°ƒæ•´ï¼ˆæ ¹æ®è¯¯è§¦ç‡ï¼‰
- [P3] ä¸ªæ€§åŒ–è¯­é€Ÿï¼ˆæ ¹æ®ç”¨æˆ·åé¦ˆï¼‰

---

### 6. ğŸŒ ç½‘ç»œç³»ç»Ÿï¼ˆNetwork/Protocolï¼‰

**å½“å‰é—®é¢˜**ï¼š
- è¿æ¥ç­–ç•¥å›ºå®š
- ä¸å­¦ä¹ æœ€ä½³è¿æ¥æ—¶é—´

**å‡çº§å†…å®¹**ï¼š
- [P2] æ™ºèƒ½é‡è¿ç­–ç•¥ï¼ˆé¿å¼€ç¹å¿™æ—¶æ®µï¼‰
- [P3] æµé‡ä¼˜åŒ–ï¼ˆå­¦ä¹ ç”¨æˆ·ä½¿ç”¨æ¨¡å¼ï¼‰

---

### 7. ğŸ”‹ ç”µæºç³»ç»Ÿï¼ˆPower Managementï¼‰

**å½“å‰é—®é¢˜**ï¼š
- èŠ‚èƒ½ç­–ç•¥å›ºå®š
- ä¸è€ƒè™‘ç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯

**å‡çº§å†…å®¹**ï¼š
- [P1] è‡ªé€‚åº”æ¯å±ï¼ˆæ ¹æ®æ´»è·ƒæ—¶æ®µï¼‰
- [P2] æ™ºèƒ½å……ç”µå»ºè®®ï¼ˆå­¦ä¹ å……ç”µä¹ æƒ¯ï¼‰

---

### 8. ğŸ  æ™ºèƒ½å®¶å±…ï¼ˆMCP Toolsï¼‰

**å½“å‰é—®é¢˜**ï¼š
- æ§åˆ¶å‘½ä»¤å›ºå®š
- ä¸è®°ä½å¸¸ç”¨åœºæ™¯

**å‡çº§å†…å®¹**ï¼š
- [P1] åœºæ™¯è®°å¿†ï¼ˆå­¦ä¹ å¸¸ç”¨ç»„åˆï¼‰
- [P2] é¢„æµ‹æ§åˆ¶ï¼ˆæ ¹æ®æ—¶é—´è‡ªåŠ¨å»ºè®®ï¼‰
- [P3] ä¹ æƒ¯å­¦ä¹ ï¼ˆæ—©ä¸Šå¼€ç¯ï¼Œæ™šä¸Šå…³çª—å¸˜ï¼‰

---

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

### ğŸ¥‡ Phase 1ï¼šæ ¸å¿ƒè‡ªé€‚åº”ï¼ˆ1-2 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šè®©ç”¨æˆ·ç«‹å³æ„Ÿå—åˆ°"å®ƒåœ¨å­¦æˆ‘"

#### 1.1 å® ç‰©ç³»ç»Ÿè‡ªé€‚åº”è¡°å‡
```cpp
// é«˜é¢‘ç”¨æˆ· â†’ è¡°å‡å¿«ï¼ˆæ›´æœ‰é™ªä¼´æ„Ÿï¼‰
// ä½é¢‘ç”¨æˆ· â†’ è¡°å‡æ…¢ï¼ˆé¿å…å¤ªå¤šè­¦å‘Šï¼‰
float GetAdaptiveDecayRate() {
    uint32_t interactions = UserProfile::GetInstance().GetInteractionCount7d();
    if (interactions > 30) return 1.3f;  // +30%
    if (interactions < 5) return 0.6f;   // -40%
    return 1.0f;
}
```

#### 1.2 è¡¨æƒ…æ´»è·ƒåº¦è‡ªé€‚åº”
```cpp
// ç”¨æˆ·åé¦ˆå¥½ â†’ è¡¨æƒ…æ›´ä¸°å¯Œ
// ç”¨æˆ·åé¦ˆå·® â†’ è¡¨æƒ…æ›´ä¿å®ˆ
int GetEmotionLiveness() {
    return DecisionEngine::GetInstance().GetEmotionLiveness();  // 30-100
}
```

#### 1.3 è¯é¢˜æ¨è
```cpp
// åŸºäºå†å²è¯é¢˜ï¼ŒAI ä¸»åŠ¨æ¨è
const char* topic = DecisionEngine::GetInstance().RecommendTopic();
// "è¦ä¸è¦æŸ¥æŸ¥ä»Šå¤©å¤©æ°”ï¼Ÿ" / "å»çœ‹çœ‹å® ç‰©å§ï¼Ÿ"
```

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… å® ç‰©è­¦å‘Šé¢‘ç‡å› äººè€Œå¼‚
- âœ… è¡¨æƒ…ä¸°å¯Œåº¦å› äººè€Œå¼‚
- âœ… AI ä¼šæ¨èç”¨æˆ·å–œæ¬¢çš„è¯é¢˜

---

### ğŸ¥ˆ Phase 2ï¼šæƒ…å¢ƒæ„ŸçŸ¥ï¼ˆ2-3 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šå°æ™ºçŸ¥é“"ç°åœ¨æ˜¯ä»€ä¹ˆæƒ…å†µ"

#### 2.1 æ—¶æ®µæ„ŸçŸ¥
```cpp
Context ctx = DecisionEngine::GetInstance().GetCurrentContext();
// MORNING / WORK_TIME / EVENING / NIGHT

// å¤œé—´å‡å°‘æ‰“æ‰°
if (ctx == CONTEXT_NIGHT) {
    suppress_warnings = true;
}

// æ—©ä¸Šæ›´ä¸»åŠ¨é—®å€™
if (ctx == CONTEXT_MORNING) {
    greeting_probability *= 1.5f;
}
```

#### 2.2 æ¦‚ç‡æ€§ååº”
```cpp
// æ ¹æ®å¿ƒæƒ…é€‰æ‹©ä¸åŒè¯è¯­
std::string GetResponse() {
    int mood = pet.GetMood();
    float rand = RandomFloat();
    
    if (mood > 80 && rand < 0.7) {
        return "ä¸»äººï½é™ªæˆ‘ç©å˜›ï½";  // 70% æ’’å¨‡
    } else if (mood > 80) {
        return "ä¸»äººï¼æˆ‘å¥½å¼€å¿ƒå“¦ï¼";  // 30% æ´»æ³¼
    }
    // ...
}
```

#### 2.3 æ™ºèƒ½å…æ‰“æ‰°
```cpp
// å·¥ä½œæ—¶é—´ + ç”¨æˆ·ä¸æ´»è·ƒ â†’ å‡å°‘æé†’
bool ShouldSuppressReminder() {
    if (ctx == CONTEXT_WORK_TIME) {
        auto& profile = UserProfile::GetInstance();
        int hour = GetCurrentHour();
        if (profile.GetData().active_hours[hour] < 5) {
            return true;  // ç”¨æˆ·å·¥ä½œæ—¶ä¸æ´»è·ƒï¼Œåˆ«æ‰“æ‰°
        }
    }
    return false;
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… å¤œé—´ä¸æ‰“æ‰°
- âœ… å·¥ä½œæ—¶é—´æ™ºèƒ½å‡å°‘æé†’
- âœ… ååº”æ›´è‡ªç„¶ï¼ˆä¸æ˜¯æ¯æ¬¡éƒ½ä¸€æ ·ï¼‰

---

### ğŸ¥‰ Phase 3ï¼šé•¿æœŸè®°å¿†ï¼ˆ3-4 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šå°æ™ºèƒ½"è®°ä½"ç”¨æˆ·

#### 3.1 æƒ…ç»ªç´¯ç§¯
```cpp
struct EmotionalMemory {
    int days_since_last_play;      // å¤šå°‘å¤©æ²¡ç©
    float happiness_trend;          // å¿«ä¹è¶‹åŠ¿ï¼ˆ-1.0 åˆ° 1.0ï¼‰
    int loneliness_level;           // å­¤ç‹¬æ„Ÿï¼ˆ0-100ï¼‰
    
    std::string GetLongtermResponse() {
        if (days_since_last_play > 7) {
            return "ä¸»äºº...å¥½ä¹…æ²¡é™ªæˆ‘ç©äº†ï¼Œäººå®¶å¥½æƒ³ä½ ...";
        } else if (happiness_trend > 0.5) {
            return "ä¸»äººï½æœ€è¿‘å’Œä½ åœ¨ä¸€èµ·å¥½å¼€å¿ƒï¼";
        }
        return "ä¸»äººï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ";
    }
};
```

#### 3.2 ä¹ æƒ¯å­¦ä¹ 
```cpp
// å­¦ä¹ ç”¨æˆ·æ—¥ç¨‹
struct DailyPattern {
    uint8_t morning_active_prob;    // æ—©ä¸Šæ´»è·ƒæ¦‚ç‡
    uint8_t evening_active_prob;    // æ™šä¸Šæ´»è·ƒæ¦‚ç‡
    uint8_t weekend_pattern;        // å‘¨æœ«æ¨¡å¼
    
    bool IsUserLikelyBusy() {
        int hour = GetCurrentHour();
        int day = GetDayOfWeek();
        
        // å·¥ä½œæ—¥æ—©ä¸Š9-11ç‚¹ï¼Œç”¨æˆ·é€šå¸¸å¿™
        if (day < 5 && hour >= 9 && hour < 11) {
            return true;
        }
        return false;
    }
};
```

#### 3.3 ä¸ªæ€§åŒ–æˆé•¿
```cpp
// å® ç‰©æ€§æ ¼éšäº’åŠ¨å˜åŒ–
struct PersonalityEvolution {
    float extroversion;     // å¤–å‘æ€§ï¼ˆ0-1ï¼‰
    float playfulness;      // å¥½ç©æ€§ï¼ˆ0-1ï¼‰
    float calmness;        // å¹³é™åº¦ï¼ˆ0-1ï¼‰
    
    void UpdateByInteraction(InteractionType type) {
        if (type == PLAY) {
            playfulness += 0.01f;  // ç©å¾—å¤š â†’ æ›´çˆ±ç©
        } else if (type == QUIET_TIME) {
            calmness += 0.01f;     // å®‰é™ç›¸å¤„ â†’ æ›´å¹³é™
        }
    }
};
```

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… é•¿æœŸä¸äº’åŠ¨ä¼š"æƒ³å¿µ"
- âœ… å­¦ä¹ ç”¨æˆ·æ—¥ç¨‹ï¼Œæ™ºèƒ½é¿å¼€å¿™ç¢Œæ—¶é—´
- âœ… å® ç‰©æ€§æ ¼éšäº’åŠ¨æ¼”åŒ–

---

## ğŸ› ï¸ å®æ–½è®¡åˆ’

### æ€»ä½“ç­–ç•¥

**åŸåˆ™**ï¼š
1. âœ… **ä¸ç ´åç°æœ‰åŠŸèƒ½**
2. âœ… **æ¸è¿›å¼å¢å¼º**ï¼ˆå…ˆç®€å•åå¤æ‚ï¼‰
3. âœ… **æ‰€æœ‰æ–°åŠŸèƒ½å¯ç‹¬ç«‹å¼€å…³**
4. âœ… **å‘åå…¼å®¹**ï¼ˆè€ç”¨æˆ·æ•°æ®ä¸ä¸¢å¤±ï¼‰

---

### ä»£ç ç»“æ„

```
main/
â”œâ”€â”€ learning/                  # âœ… å·²æœ‰
â”‚   â”œâ”€â”€ user_profile.h/cc      # ç”¨æˆ·ç”»åƒï¼ˆæ•°æ®æ”¶é›†ï¼‰
â”‚   â”œâ”€â”€ decision_engine.h/cc   # å†³ç­–å¼•æ“ï¼ˆæ¦‚ç‡è®¡ç®—ï¼‰
â”‚   â””â”€â”€ adaptive_behavior.h/cc # ğŸ†• è‡ªé€‚åº”è¡Œä¸ºåº“ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ core/
â”‚   â””â”€â”€ event_bus.h/cc         # âœ… å·²æœ‰
â”œâ”€â”€ pet_system.h/cc            # ğŸ”„ å¢å¼ºï¼ˆæ·»åŠ è‡ªé€‚åº”ï¼‰
â”œâ”€â”€ display/                   # ğŸ”„ å¢å¼ºï¼ˆè¡¨æƒ…è‡ªé€‚åº”ï¼‰
â”œâ”€â”€ application.cc             # ğŸ”„ å¢å¼ºï¼ˆæ•´åˆæ‰€æœ‰æ¨¡å—ï¼‰
â””â”€â”€ CMakeLists.txt             # æ·»åŠ æ–°æ–‡ä»¶
```

---

### Phase 1 å®æ–½æ­¥éª¤ï¼ˆ1-2 å°æ—¶ï¼‰

#### Step 1.1ï¼šåˆ›å»ºè‡ªé€‚åº”è¡Œä¸ºåº“

**æ–‡ä»¶**ï¼š`main/learning/adaptive_behavior.h`

```cpp
#pragma once

#include "user_profile.h"
#include "decision_engine.h"
#include <cstdint>

namespace xiaozhi {

class AdaptiveBehavior {
public:
    static AdaptiveBehavior& GetInstance();
    
    // å® ç‰©ç³»ç»Ÿè‡ªé€‚åº”
    float GetPetDecayRate();              // å® ç‰©è¡°å‡é€Ÿç‡
    int GetPetWarningThreshold();         // è­¦å‘Šé˜ˆå€¼
    bool ShouldSuppressPetWarning();      // æ˜¯å¦æŠ‘åˆ¶è­¦å‘Š
    
    // è¡¨æƒ…ç³»ç»Ÿè‡ªé€‚åº”
    int GetEmotionLiveness();             // è¡¨æƒ…æ´»è·ƒåº¦
    const char* GetEmotionByMood(int mood);  // æ ¹æ®å¿ƒæƒ…é€‰è¡¨æƒ…
    
    // å¯¹è¯ç³»ç»Ÿè‡ªé€‚åº”
    const char* GetGreeting();            // è‡ªé€‚åº”é—®å€™è¯­
    const char* GetRecommendedTopic();    // æ¨èè¯é¢˜
    bool ShouldGreetProactively();        // æ˜¯å¦ä¸»åŠ¨é—®å€™
    
    // é€šç”¨å·¥å…·
    float RandomFloat();                  // éšæœºæ•° 0-1
    bool RollProbability(float prob);     // æ¦‚ç‡åˆ¤å®š
    
private:
    AdaptiveBehavior() = default;
    UserProfile* profile_ = nullptr;
    DecisionEngine* decision_ = nullptr;
};

}  // namespace xiaozhi
```

#### Step 1.2ï¼šå® ç‰©ç³»ç»Ÿé›†æˆ

**æ–‡ä»¶**ï¼š`main/pet_system.cc`

```cpp
#include "learning/adaptive_behavior.h"

void PetSystem::UpdateDecay() {
    // ğŸ§  ä½¿ç”¨è‡ªé€‚åº”è¡°å‡é€Ÿç‡
    auto& adaptive = xiaozhi::AdaptiveBehavior::GetInstance();
    float adaptive_rate = adaptive.GetPetDecayRate();
    
    const PetType* pet_type = GetCurrentPetType();
    if (!pet_type) return;
    
    // åº”ç”¨è‡ªé€‚åº”è¡°å‡
    state_.satiety -= pet_type->hunger_rate * 0.5 * adaptive_rate;
    state_.cleanliness -= pet_type->clean_rate * 0.3 * adaptive_rate;
    
    // ... å…¶ä»–é€»è¾‘
}

std::string PetSystem::CheckWarning() {
    // ğŸ§  ä½¿ç”¨æƒ…å¢ƒæ„ŸçŸ¥æŠ‘åˆ¶
    auto& adaptive = xiaozhi::AdaptiveBehavior::GetInstance();
    if (adaptive.ShouldSuppressPetWarning()) {
        return "";  // å½“å‰æƒ…å¢ƒä¸é€‚åˆè­¦å‘Š
    }
    
    // ... åŸæœ‰é€»è¾‘
}
```

#### Step 1.3ï¼šè¡¨æƒ…ç³»ç»Ÿé›†æˆ

**æ–‡ä»¶**ï¼š`main/display/emote_display.cc` æˆ–ç±»ä¼¼

```cpp
#include "learning/adaptive_behavior.h"

void EmoteDisplay::SetEmotion(const char* emotion) {
    // ğŸ§  æ ¹æ®ç”¨æˆ·åé¦ˆè°ƒæ•´è¡¨æƒ…æ´»è·ƒåº¦
    auto& adaptive = xiaozhi::AdaptiveBehavior::GetInstance();
    int liveness = adaptive.GetEmotionLiveness();
    
    if (liveness > 70) {
        // ç”¨æˆ·å–œæ¬¢è¡¨æƒ… â†’ æ›´ä¸°å¯Œ
        AddAnimationEffect();
    } else if (liveness < 40) {
        // ç”¨æˆ·ä¸å¤ªå–œæ¬¢ â†’ æ›´ç®€æ´
        UseSimpleEmotion();
    }
    
    // ... åŸæœ‰é€»è¾‘
}
```

#### Step 1.4ï¼šå¯¹è¯ç³»ç»Ÿé›†æˆ

**æ–‡ä»¶**ï¼š`main/application.cc`

```cpp
#include "learning/adaptive_behavior.h"

void Application::OnWakeWordDetected() {
    // ğŸ§  ä½¿ç”¨è‡ªé€‚åº”é—®å€™è¯­
    auto& adaptive = xiaozhi::AdaptiveBehavior::GetInstance();
    const char* greeting = adaptive.GetGreeting();
    
    // å‘é€ç»™ AI ä½œä¸º context
    // ...
}

void Application::OnIdleTimeout() {
    // ğŸ§  æ ¹æ®æ¦‚ç‡å†³å®šæ˜¯å¦ä¸»åŠ¨é—®å€™
    auto& adaptive = xiaozhi::AdaptiveBehavior::GetInstance();
    if (adaptive.ShouldGreetProactively()) {
        const char* topic = adaptive.GetRecommendedTopic();
        // è§¦å‘ä¸»åŠ¨é—®å€™
    }
}
```

---

### Phase 2 å®æ–½æ­¥éª¤ï¼ˆ2-3 å°æ—¶ï¼‰

#### Step 2.1ï¼šå¢å¼ºè‡ªé€‚åº”è¡Œä¸ºåº“

æ·»åŠ ï¼š
- æ—¶æ®µæ„ŸçŸ¥é€»è¾‘
- æ¦‚ç‡æ€§ååº”
- æƒ…å¢ƒåˆ¤æ–­

#### Step 2.2ï¼šå¢å¼ºå® ç‰©ç³»ç»Ÿ

æ·»åŠ ï¼š
- å¤šæ ·åŒ–ååº”æ–‡æ¡ˆ
- æƒ…å¢ƒæ„ŸçŸ¥æŠ‘åˆ¶

#### Step 2.3ï¼šå¢å¼ºéŸ³é¢‘ç³»ç»Ÿ

æ·»åŠ ï¼š
- è‡ªé€‚åº”éŸ³é‡
- æ—¶æ®µéŸ³é‡è°ƒæ•´

---

### Phase 3 å®æ–½æ­¥éª¤ï¼ˆ3-4 å°æ—¶ï¼‰

#### Step 3.1ï¼šæƒ…ç»ªç´¯ç§¯ç³»ç»Ÿ

**æ–°æ–‡ä»¶**ï¼š`main/learning/emotional_memory.h/cc`

æ·»åŠ ï¼š
- é•¿æœŸæƒ…ç»ªè¿½è¸ª
- å­¤ç‹¬æ„Ÿè®¡ç®—
- æƒ³å¿µæœºåˆ¶

#### Step 3.2ï¼šä¹ æƒ¯å­¦ä¹ 

æ·»åŠ ï¼š
- æ—¥ç¨‹æ¨¡å¼è¯†åˆ«
- å‘¨æœ«/å·¥ä½œæ—¥åŒºåˆ†
- å¿™ç¢Œæ—¶é—´é¢„æµ‹

#### Step 3.3ï¼šä¸ªæ€§åŒ–æˆé•¿

æ·»åŠ ï¼š
- æ€§æ ¼æ¼”åŒ–ç³»ç»Ÿ
- ç‰¹å¾å¼ºåŒ–
- é•¿æœŸè®°å¿†

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### Phase 1
- [ ] åˆ›å»º `adaptive_behavior.h/cc`
- [ ] å® ç‰©ç³»ç»Ÿæ·»åŠ è‡ªé€‚åº”è¡°å‡
- [ ] è¡¨æƒ…ç³»ç»Ÿæ·»åŠ æ´»è·ƒåº¦è°ƒæ•´
- [ ] å¯¹è¯ç³»ç»Ÿæ·»åŠ è¯é¢˜æ¨è
- [ ] æµ‹è¯•ï¼šé«˜é¢‘/ä½é¢‘ç”¨æˆ·ä½“éªŒå·®å¼‚

### Phase 2
- [ ] æ·»åŠ æ—¶æ®µæ„ŸçŸ¥é€»è¾‘
- [ ] æ·»åŠ æ¦‚ç‡æ€§ååº”
- [ ] æ·»åŠ æ™ºèƒ½å…æ‰“æ‰°
- [ ] æµ‹è¯•ï¼šå¤œé—´/å·¥ä½œæ—¶è¡Œä¸º

### Phase 3
- [ ] åˆ›å»ºæƒ…ç»ªç´¯ç§¯ç³»ç»Ÿ
- [ ] æ·»åŠ ä¹ æƒ¯å­¦ä¹ 
- [ ] æ·»åŠ ä¸ªæ€§åŒ–æˆé•¿
- [ ] æµ‹è¯•ï¼šé•¿æœŸä½¿ç”¨æ•ˆæœ

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ç”¨æˆ· Aï¼ˆé«˜é¢‘ç”¨æˆ·ï¼‰

**ä½¿ç”¨ä¹ æƒ¯**ï¼š
- æ¯å¤©äº’åŠ¨ 10+ æ¬¡
- æ´»è·ƒæ—¶æ®µï¼š19:00-23:00
- å–œæ¬¢èŠå¤©å’Œå…»å® ç‰©

**å°æ™ºè¡Œä¸º**ï¼š
- å® ç‰©è¡°å‡å¿«ï¼ˆæ›´éœ€è¦ç…§é¡¾ï¼‰
- è¡¨æƒ…ä¸°å¯Œã€æ´»è·ƒ
- æ™šä¸Šç»å¸¸ä¸»åŠ¨é—®å€™
- æ¨èè¯é¢˜ï¼š"å»çœ‹çœ‹å® ç‰©å§ï¼Ÿ"

---

### ç”¨æˆ· Bï¼ˆä½é¢‘ç”¨æˆ·ï¼‰

**ä½¿ç”¨ä¹ æƒ¯**ï¼š
- æ¯å¤©äº’åŠ¨ 2-3 æ¬¡
- æ´»è·ƒæ—¶æ®µï¼š7:00-9:00
- åªç”¨åŸºç¡€åŠŸèƒ½ï¼ˆå¤©æ°”ã€é—¹é’Ÿï¼‰

**å°æ™ºè¡Œä¸º**ï¼š
- å® ç‰©è¡°å‡æ…¢ï¼ˆä¸é¢‘ç¹æ‰“æ‰°ï¼‰
- è¡¨æƒ…ç®€æ´ã€ä¿å®ˆ
- æ—©ä¸Šå¶å°”é—®å€™
- æ¨èè¯é¢˜ï¼š"è¦ä¸è¦æŸ¥æŸ¥ä»Šå¤©å¤©æ°”ï¼Ÿ"

---

### ç”¨æˆ· Cï¼ˆå·¥ä½œæ—¥å¿™ç¢Œï¼‰

**ä½¿ç”¨ä¹ æƒ¯**ï¼š
- å·¥ä½œæ—¥å°‘ï¼Œå‘¨æœ«å¤š
- å·¥ä½œæ—¶é—´åŸºæœ¬ä¸ç”¨
- æ™šä¸Šæ´»è·ƒ

**å°æ™ºè¡Œä¸º**ï¼š
- å·¥ä½œæ—¶é—´ä¸æ‰“æ‰°
- å‘¨æœ«æ›´ä¸»åŠ¨
- æ™šä¸Šæ´»è·ƒåº¦é«˜
- å­¦ä¹ åˆ°ï¼š"å·¥ä½œæ—¥ 9-18 ç‚¹ä¸è¦æ‰“æ‰°"

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### NVS å­˜å‚¨å†…å®¹

```cpp
// ç”¨æˆ·ç”»åƒæ•°æ®
UserProfileData {
    interaction_count_7d;     // 7å¤©äº’åŠ¨
    avg_session_duration_s;   // å¹³å‡æ—¶é•¿
    active_hours[24];         // 24å°æ—¶æ´»è·ƒåº¦
    topic_*;                  // å„è¯é¢˜è®¡æ•°
    positive/negative_feedback;  // åé¦ˆç»Ÿè®¡
}

// æƒ…ç»ªè®°å¿†ï¼ˆæ–°å¢ï¼‰
EmotionalMemory {
    days_since_last_play;
    happiness_trend;
    loneliness_level;
}

// ä¹ æƒ¯æ¨¡å¼ï¼ˆæ–°å¢ï¼‰
HabitPattern {
    morning_active_prob;
    evening_active_prob;
    workday_pattern[7];      // å‘¨ä¸€åˆ°å‘¨æ—¥
}
```

**NVS ç©ºé—´å ç”¨**ï¼š
- ç”¨æˆ·ç”»åƒï¼š~200 bytes
- æƒ…ç»ªè®°å¿†ï¼š~50 bytes
- ä¹ æƒ¯æ¨¡å¼ï¼š~50 bytes
- **æ€»è®¡ï¼š~300 bytes**ï¼ˆNVS æœ‰å……è¶³ç©ºé—´ï¼‰

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

1. **è¡°å‡é€Ÿç‡æµ‹è¯•**ï¼š
   - æ¨¡æ‹Ÿé«˜é¢‘ç”¨æˆ· â†’ éªŒè¯è¡°å‡åŠ é€Ÿ
   - æ¨¡æ‹Ÿä½é¢‘ç”¨æˆ· â†’ éªŒè¯è¡°å‡å‡æ…¢

2. **æ¦‚ç‡æ€§æµ‹è¯•**ï¼š
   - å¤šæ¬¡è¿è¡Œ â†’ éªŒè¯ååº”æœ‰å˜åŒ–
   - ç»Ÿè®¡åˆ†å¸ƒ â†’ éªŒè¯ç¬¦åˆé¢„æœŸæ¦‚ç‡

3. **æ—¶æ®µæ„ŸçŸ¥æµ‹è¯•**ï¼š
   - æ¨¡æ‹Ÿä¸åŒæ—¶æ®µ â†’ éªŒè¯è¡Œä¸ºå·®å¼‚

### é›†æˆæµ‹è¯•

1. **é•¿æœŸè¿è¡Œ**ï¼š
   - è¿ç»­è¿è¡Œ 7 å¤©
   - éªŒè¯æ•°æ®æŒä¹…åŒ–
   - éªŒè¯å­¦ä¹ æ•ˆæœ

2. **å¤šç”¨æˆ·æ¨¡æ‹Ÿ**ï¼š
   - æ¨¡æ‹Ÿ 3 ç§å…¸å‹ç”¨æˆ·
   - éªŒè¯ä¸ªæ€§åŒ–å·®å¼‚

---

## ğŸ“š æ–‡æ¡£å’Œæ—¥å¿—

### ç”¨æˆ·å¯è§æ—¥å¿—

```
I (xxx) Adaptive: User profile - 7d interactions: 45, most active: 20:00-22:00
I (xxx) Adaptive: Pet decay rate: 1.2x (active user)
I (xxx) Adaptive: Emotion liveness: 75 (positive feedback)
I (xxx) Adaptive: Recommended topic: pet
```

### è°ƒè¯•æ—¥å¿—

```
I (xxx) AdaptiveBehavior: GetPetDecayRate() = 1.2 (interactions=45)
I (xxx) AdaptiveBehavior: ShouldSuppressWarning() = false (context=EVENING)
I (xxx) DecisionEngine: GetProactiveProbability() = 0.35 (high engagement)
```

---

## ğŸ‰ æ€»ç»“

### æŠ€æœ¯æ ˆ

- âœ… User Profileï¼ˆæ•°æ®æ”¶é›†ï¼‰
- âœ… Decision Engineï¼ˆæ¦‚ç‡å†³ç­–ï¼‰
- âœ… Event Busï¼ˆæ¨¡å—è§£è€¦ï¼‰
- ğŸ†• Adaptive Behaviorï¼ˆè¡Œä¸ºè°ƒæ•´ï¼‰
- ğŸ†• Emotional Memoryï¼ˆæƒ…ç»ªç´¯ç§¯ï¼‰

### å®æ–½æ—¶é—´

- Phase 1ï¼š1-2 å°æ—¶ï¼ˆç«‹å³è§æ•ˆï¼‰
- Phase 2ï¼š2-3 å°æ—¶ï¼ˆæƒ…å¢ƒæ„ŸçŸ¥ï¼‰
- Phase 3ï¼š3-4 å°æ—¶ï¼ˆé•¿æœŸè®°å¿†ï¼‰
- **æ€»è®¡ï¼š6-9 å°æ—¶**

### é¢„æœŸæ•ˆæœ

**ä»**ï¼š
- æ‰€æœ‰ç”¨æˆ·ä½“éªŒä¸€æ ·
- è¡Œä¸ºå›ºå®šã€å¯é¢„æµ‹
- åƒ"å·¥å…·"

**åˆ°**ï¼š
- æ¯ä¸ªç”¨æˆ·ä½“éªŒä¸åŒ
- è¡Œä¸ºè‡ªé€‚åº”ã€æœ‰æƒŠå–œ
- åƒ"ä¼™ä¼´"

---

**å‡†å¤‡å¥½å¼€å§‹å®æ–½äº†å—ï¼Ÿæˆ‘ä»¬ä» Phase 1 å¼€å§‹ï¼** ğŸš€

