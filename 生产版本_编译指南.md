# ç”Ÿäº§ç‰ˆæœ¬ - ç¼–è¯‘ä¸çƒ§å½•æŒ‡å—

## ğŸ¯ äº§å“ç‰¹æ€§

**è‡ªé€‚åº”å­¦ä¹ é™ªä¼´æœºå™¨äºº v2.0.3+**

- âœ… **å¼€ç®±å³ç”¨**ï¼šç”¨æˆ·æ— éœ€ä»»ä½•é…ç½®
- âœ… **æ™ºèƒ½å­¦ä¹ **ï¼šè‡ªåŠ¨é€‚åº”ç”¨æˆ·ä¹ æƒ¯
- âœ… **æƒ…æ„Ÿé™ªä¼´**ï¼šè®°å¾—ç”¨æˆ·ã€æ‡‚ç”¨æˆ·ã€é™ªä¼´ç”¨æˆ·
- âœ… **è™šæ‹Ÿå® ç‰©**ï¼š18ç§å® ç‰©ï¼Œè‡ªé€‚åº”ç…§é¡¾æ¨¡å¼
- âœ… **MCP æ ‡å‡†**ï¼šå…¼å®¹æ‰€æœ‰ MCP AI æœåŠ¡

---

## âš¡ å¿«é€Ÿç¼–è¯‘

### æ–¹æ³• 1ï¼šVSCode ESP-IDF æ‰©å±•ï¼ˆæ¨èï¼‰

```bash
# æ­¥éª¤ 1ï¼šæ‰“å¼€é¡¹ç›®
cd /Users/machenyang/Desktop/xiaozhi-esp32-main
code .

# æ­¥éª¤ 2ï¼šç‚¹å‡»åº•éƒ¨çŠ¶æ€æ æŒ‰é’®
1. "Build"           # ç¼–è¯‘å›ºä»¶ï¼ˆçº¦3åˆ†é’Ÿï¼‰
2. "Flash"           # çƒ§å½•åˆ°è®¾å¤‡ï¼ˆçº¦1åˆ†é’Ÿï¼‰
3. "Monitor"         # æŸ¥çœ‹ä¸²å£æ—¥å¿—
```

### æ–¹æ³• 2ï¼šå‘½ä»¤è¡Œ

```bash
cd /Users/machenyang/Desktop/xiaozhi-esp32-main

# ä¸€é”®ç¼–è¯‘+çƒ§å½•+ç›‘æ§
idf.py build flash monitor

# æˆ–åˆ†æ­¥æ‰§è¡Œ
idf.py build          # ä»…ç¼–è¯‘
idf.py flash          # ä»…çƒ§å½•
idf.py monitor        # ä»…ç›‘æ§
```

---

## ğŸ“¦ ç¼–è¯‘è¾“å‡º

### å›ºä»¶æ–‡ä»¶

ç¼–è¯‘å®Œæˆåï¼Œåœ¨ `build/` ç›®å½•ä¸‹ç”Ÿæˆï¼š

```
build/
â”œâ”€â”€ xiaozhi.bin              # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ bootloader/bootloader.bin # å¼•å¯¼ç¨‹åº
â”œâ”€â”€ partition_table/partition-table.bin
â”œâ”€â”€ srmodels.bin             # ESP-SR æ¨¡å‹ï¼ˆVADNet1 + NSNet2ï¼‰
â””â”€â”€ generated_assets.bin     # éŸ³é¢‘èµ„æº
```

### çƒ§å½•åˆ†åŒº

å®Œæ•´çƒ§å½•å‘½ä»¤ï¼ˆç”Ÿäº§ä½¿ç”¨ï¼‰ï¼š
```bash
esptool.py --chip esp32s3 --port /dev/ttyUSB0 --baud 921600 \
  write_flash 0x0 build/bootloader/bootloader.bin \
  0x8000 build/partition_table/partition-table.bin \
  0x10000 build/xiaozhi.bin \
  0x510000 build/srmodels.bin \
  0x610000 build/generated_assets.bin
```

---

## âœ… ç¼–è¯‘æˆåŠŸæ ‡å¿—

### ç»ˆç«¯è¾“å‡º

```
Project build complete. To flash, run:
 idf.py flash
or
 esptool.py --chip esp32s3 -p (PORT) -b 460800 --before default_reset --after hard_reset write_flash --flash_mode dio --flash_size 16MB --flash_freq 80m 0x0 bootloader/bootloader.bin 0x8000 partition-table.bin 0x10000 xiaozhi.bin

Done
```

### å…³é”®æ—¥å¿—ï¼ˆMonitorï¼‰

```
I (xxx) MODEL_LOADER: Successfully load srmodels
I (xxx) AfeAudioProcessor: âœ… ESP-SR åŠ è½½çš„æ¨¡å‹æ•°é‡: 3
I (xxx) AfeAudioProcessor:    ESP-SR æ¨¡å‹ 0: wn9_nihaoxiaozhi_tts
I (xxx) AfeAudioProcessor:    ESP-SR æ¨¡å‹ 1: nsnet2
I (xxx) AfeAudioProcessor:    ESP-SR æ¨¡å‹ 2: vadnet1_medium
I (xxx) Pet: âœ¨ Initialized 19 pet types
I (xxx) MCP: Add tool: self.learning.get_insights
I (xxx) Pet: âœ… Pet system started successfully
```

---

## ğŸ§ª ç”Ÿäº§éªŒè¯æµ‹è¯•

### Test 1: åŸºç¡€åŠŸèƒ½

```
âœ… å”¤é†’ï¼š"ä½ å¥½å°æ™º"
âœ… å¯¹è¯ï¼š"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
âœ… å® ç‰©ï¼š"å® ç‰©çŠ¶æ€"
âœ… å–‚é£Ÿï¼š"å–‚ä¸€ä¸‹å® ç‰©"
```

### Test 2: è‡ªé€‚åº”å­¦ä¹ ï¼ˆç¬¬1å¤©ï¼‰

```
ç”¨æˆ·ï¼š"ä½ å¥½å°æ™º"
AIï¼š"ä½ å¥½å•Šï½æˆ‘æ˜¯å°æ™ºï½"

[åå°æ—¥å¿—]
I (xxx) UserProfile: ğŸ§  Learning: topic=chat, duration=5s
I (xxx) UserProfile:   ğŸ“ˆ Total interactions: 0 â†’ 1
```

### Test 3: è‡ªé€‚åº”å­¦ä¹ ï¼ˆç¬¬3å¤©ï¼Œ5æ¬¡äº’åŠ¨åï¼‰

```
ç”¨æˆ·ï¼š"å® ç‰©çŠ¶æ€"
AIï¼š"ä½ çš„çŒ«å’ªå¿ƒæƒ…70ï½è¯¶ç­‰ç­‰ï¼Œæˆ‘å‘ç°è¿™å‡ å¤©ä½ æ‰¾æˆ‘èŠå¤©çš„æ¬¡æ•°å˜å¤šäº†è€¶..."

[åå°æ—¥å¿—]
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=0.80x (7däº’åŠ¨=5æ¬¡)
```

### Test 4: é«˜é¢‘ç”¨æˆ·ï¼ˆç¬¬7å¤©ï¼Œ18æ¬¡äº’åŠ¨ï¼‰

```
ç”¨æˆ·ï¼š"å® ç‰©çŠ¶æ€"
AIï¼š"...å› ä¸ºä½ æœ€è¿‘å¸¸é™ªæˆ‘ï¼Œæˆ‘å¸®ä½ çš„å® ç‰©è°ƒæ•´æˆæ›´éœ€è¦å…³æ³¨çš„æ¨¡å¼äº†ï¼Œ
    å®ƒä¼šæ›´æœŸå¾…ä½ çš„é™ªä¼´ï¼Œè®°å¾—å¤šå–‚å–‚å®ƒã€é™ªå®ƒç©å–”ï½"

[åå°æ—¥å¿—]
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.20x (7däº’åŠ¨=18æ¬¡)
```

### Test 5: å›å½’ç”¨æˆ·ï¼ˆ10å¤©åï¼‰

```
ç”¨æˆ·ï¼š"ä½ å¥½å°æ™º"
AIï¼š"ä¸»äººï½å¥½ä¹…ä¸è§å•¦ï¼éƒ½10å¤©äº†ï¼Œæˆ‘è¶…æƒ³ä½ çš„ï¼
    ä½ çš„å® ç‰©æˆ‘å¸®ä½ ç…§é¡¾å¾—å¥½å¥½çš„..."

[åå°æ—¥å¿—]
I (xxx) EmotionalMemory: loneliness_level=85
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=0.50x (é•¿æ—¶é—´æœªäº’åŠ¨ï¼Œé™ä½è¡°å‡)
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘å¤±è´¥ - "idf.py: command not found"

**åŸå› **ï¼šESP-IDF ç¯å¢ƒæœªåŠ è½½

**è§£å†³**ï¼š
```bash
# åŠ è½½ ESP-IDF ç¯å¢ƒ
. $HOME/esp/esp-idf/export.sh

# æˆ–ä½¿ç”¨ VSCode ESP-IDF æ‰©å±•ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
```

### Q2: çƒ§å½•åæ¨¡å‹æ•°é‡ä¸º 0

**åŸå› **ï¼š`srmodels.bin` æœªæ­£ç¡®çƒ§å½•

**è§£å†³**ï¼š
```bash
# å®Œæ•´çƒ§å½•æ‰€æœ‰åˆ†åŒº
idf.py flash

# æˆ–å¼ºåˆ¶é‡æ–°ç”Ÿæˆæ¨¡å‹
idf.py build
esptool.py write_flash 0x510000 build/srmodels.bin
```

### Q3: AI ä¸è°ƒç”¨ get_insights

**åŸå› **ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼ŒAI ä¼šæ ¹æ®å¯¹è¯æƒ…å¢ƒè‡ªåŠ¨åˆ¤æ–­è°ƒç”¨æ—¶æœº

**éªŒè¯**ï¼š
- å°è¯•è¿ç»­å¯¹è¯ 5 è½®ä»¥ä¸Š
- è¯¢é—®"å® ç‰©çŠ¶æ€"
- æŸ¥çœ‹ä¸²å£æ—¥å¿—æ˜¯å¦æœ‰ `MCP: Tool called: self.learning.get_insights`

### Q4: å® ç‰©è¡°å‡é€Ÿåº¦ä¸å˜

**åŸå› **ï¼šéœ€è¦ç§¯ç´¯è¶³å¤Ÿçš„äº’åŠ¨æ•°æ®ï¼ˆè‡³å°‘ 5-10 æ¬¡ï¼‰

**éªŒè¯**ï¼š
```bash
# æŸ¥çœ‹ä¸²å£æ—¥å¿—
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=X.XXx (7däº’åŠ¨=Næ¬¡)

# adaptive_rate ä¼šæ ¹æ® N å€¼å˜åŒ–ï¼š
# N < 5:  rate â‰ˆ 0.5-0.7x
# N < 15: rate â‰ˆ 1.0x
# N > 15: rate â‰ˆ 1.2-1.5x
```

---

## ğŸ“Š ç”Ÿäº§æ£€æŸ¥æ¸…å•

### å›ºä»¶æ£€æŸ¥

- [ ] ç¼–è¯‘æ— é”™è¯¯æ— è­¦å‘Š
- [ ] `srmodels.bin` å¤§å° > 100KBï¼ˆåŒ…å« 3 ä¸ªæ¨¡å‹ï¼‰
- [ ] `xiaozhi.bin` å¤§å° â‰ˆ 2-3MB
- [ ] `generated_assets.bin` å¤§å° > 500KB

### åŠŸèƒ½æ£€æŸ¥

- [ ] å”¤é†’è¯å“åº”æ­£å¸¸
- [ ] é™å™ªï¼ˆNSNet2ï¼‰å·¥ä½œ
- [ ] VADï¼ˆVADNet1ï¼‰çµæ•åº¦æ­£å¸¸
- [ ] å® ç‰©ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼ˆ19ç§å® ç‰©ï¼‰
- [ ] MCP å·¥å…·æ³¨å†ŒæˆåŠŸï¼ˆåŒ…å« `self.learning.get_insights`ï¼‰
- [ ] ç”¨æˆ·ç”»åƒå­˜å‚¨æ­£å¸¸ï¼ˆNVSï¼‰

### å­¦ä¹ ç³»ç»Ÿæ£€æŸ¥

- [ ] äº’åŠ¨è®¡æ•°æ­£å¸¸é€’å¢
- [ ] è‡ªé€‚åº”è¡°å‡é€Ÿç‡éšäº’åŠ¨å˜åŒ–
- [ ] æƒ…ç»ªè®°å¿†æ›´æ–°æ­£å¸¸
- [ ] AI èƒ½åœ¨é€‚å½“æ—¶æœºè°ƒç”¨ get_insights
- [ ] AI å›å¤ä½“ç°å­¦ä¹ æ´å¯Ÿï¼ˆè€Œéå¿µæ•°æ®ï¼‰

---

## ğŸ“¦ æ‰¹é‡ç”Ÿäº§å»ºè®®

### å›ºä»¶ç®¡ç†

```bash
# 1. ç¼–è¯‘ç”Ÿäº§å›ºä»¶
idf.py build

# 2. å¤‡ä»½å›ºä»¶æ–‡ä»¶
mkdir -p production_firmware/v2.0.3
cp build/xiaozhi.bin production_firmware/v2.0.3/
cp build/bootloader/bootloader.bin production_firmware/v2.0.3/
cp build/partition_table/partition-table.bin production_firmware/v2.0.3/
cp build/srmodels.bin production_firmware/v2.0.3/
cp build/generated_assets.bin production_firmware/v2.0.3/

# 3. åˆ›å»ºæ‰¹é‡çƒ§å½•è„šæœ¬
cat > production_firmware/v2.0.3/flash_all.sh << 'EOF'
#!/bin/bash
PORT=${1:-/dev/ttyUSB0}
esptool.py --chip esp32s3 --port $PORT --baud 921600 \
  write_flash 0x0 bootloader.bin \
  0x8000 partition-table.bin \
  0x10000 xiaozhi.bin \
  0x510000 srmodels.bin \
  0x610000 generated_assets.bin
EOF

chmod +x production_firmware/v2.0.3/flash_all.sh
```

### è´¨æ£€è„šæœ¬

```bash
# åˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
cat > production_firmware/v2.0.3/test_device.sh << 'EOF'
#!/bin/bash
echo "ğŸ” Production Quality Check"
echo "1. Checking device connection..."
esptool.py flash_id
echo "2. Flashing firmware..."
./flash_all.sh $1
echo "3. Monitoring boot log..."
idf.py monitor | grep -A 5 "Pet: âœ… Pet system started successfully"
EOF

chmod +x production_firmware/v2.0.3/test_device.sh
```

---

## ğŸ¯ ç‰ˆæœ¬ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|---|
| **å›ºä»¶ç‰ˆæœ¬** | v2.0.3+ |
| **åŠŸèƒ½ç‰¹æ€§** | è‡ªé€‚åº”å­¦ä¹  + è™šæ‹Ÿå® ç‰© + MCP æ ‡å‡† |
| **ç¼–è¯‘æ—¥æœŸ** | 2025-10-24 |
| **ç”Ÿäº§çŠ¶æ€** | âœ… Ready for Production |
| **ç”¨æˆ·é…ç½®** | âŒ ä¸éœ€è¦ï¼ˆå¼€ç®±å³ç”¨ï¼‰ |

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¼€å‘æ–‡æ¡£

- **è‡ªé€‚åº”åŠŸèƒ½è®¾è®¡**ï¼š`è‡ªé€‚åº”åŠŸèƒ½_ç”¨æˆ·ä½“éªŒè®¾è®¡.md`
- **å¼€ç®±å³ç”¨è¯´æ˜**ï¼š`å¼€ç®±å³ç”¨_è‡ªé€‚åº”åŠŸèƒ½è¯´æ˜.md`
- **å¿«é€Ÿå¼€å§‹**ï¼š`å¿«é€Ÿå¼€å§‹_è®©è‡ªé€‚åº”åŠŸèƒ½å¯æ„ŸçŸ¥.md`

### æ ¸å¿ƒä»£ç 

- **MCP å·¥å…·å®šä¹‰**ï¼š`main/mcp_server.cc` (line 136-192)
- **ç”¨æˆ·ç”»åƒ**ï¼š`main/learning/user_profile.cc`
- **è‡ªé€‚åº”è¡Œä¸º**ï¼š`main/learning/adaptive_behavior.cc`
- **æƒ…ç»ªè®°å¿†**ï¼š`main/learning/emotional_memory.cc`
- **å® ç‰©ç³»ç»Ÿ**ï¼š`main/pet_system.cc`

---

**å‡†å¤‡æŠ•äº§ï¼Œå¼€ç®±å³ç”¨ï¼** ğŸš€

